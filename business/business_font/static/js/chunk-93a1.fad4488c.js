(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-93a1"],{25:function(t,e){},26:function(t,e){},27:function(t,e){},28:function(t,e){},"3CBT":function(t,e,s){t.exports=s.p+"static/img/pdfpng.143be43.png"},FoOq:function(t,e,s){"use strict";s.r(e);s("LKdb");var o=s("A018");o.GlobalWorkerOptions.workerSrc=s("53iY");var n={data:function(){return{isShow:!1,signVisible:!1,count:0,timer:null,Data:{},dom:null,scrollTop:0,activeName:"2",pdfUrl:"",pdfDoc:null,pageNum:1,value1:1,scale:1,page_num:0,page_count:0,maxscale:2,minscale:.5,pdfWidth:0,pdfHeight:0,right:!0,left:!0,code:"",activities:[{content:"支持自定义颜色",timestamp:"2018-04-03 20:46",color:"#0bbd87"},{content:"支持自定义尺寸",timestamp:"2018-04-03 20:46",size:"large"},{content:"默认样式的节点",timestamp:"2018-04-03 20:46"}],commonStructsList:[]}},created:function(){this.contract_id=this.$route.params.id},mounted:function(){this.$nextTick(function(){this.$refs.pdfBox.addEventListener("scroll",this.handleScroll,!1),this.getData()})},watch:{scale:function(t,e){document.querySelectorAll(".mark").forEach(function(s){s.style.left=parseInt(s.style.left)/(e/t)+"px",s.style.top=parseInt(s.style.top)/(e/t)+"px",s.style.height=100*t+"px",s.style.width=100*t+"px"}),document.querySelectorAll(".text_mark").forEach(function(s){s.style.left=parseInt(s.style.left)/(e/t)+"px",s.style.top=parseInt(s.style.top)/(e/t)+"px",s.style.height=28*t+"px",s.style.width=s.offsetWidth/(e/t)+"px"}),document.querySelectorAll(".text_mark2").forEach(function(s){s.style.left=parseInt(s.style.left)/(e/t)+"px",s.style.top=parseInt(s.style.top)/(e/t)+"px",s.style.height=100*t+"px",s.style.width=100*t+"px"})}},methods:{showSign:function(){document.querySelectorAll(".mark").length<=0?this.$message.error("请先拖拽盖章"):this.signVisible=!0},sendCode:function(){var t=this;$http.post("plugin.yun-sign.frontend.contract.send-code",{contract_id:this.contract_id},"loading").then(function(e){if(1===e.result){t.timer||(t.count=60,t.timer=setInterval(function(){t.count>0&&t.count<=60?t.count--:(clearInterval(t.timer),t.timer=null)},1e3))}else t.$message.error(e.msg)}).catch(function(t){console.log(t)})},companySign:function(){var t=this;this.code?$http.post("plugin.yun-sign.frontend.contract.sign-contract",{form:{file_name:window.localStorage.getItem("pdfUrl"),code:this.code,order_sn:this.$route.query.order_sn}},"loading").then(function(e){t.code="",1===e.result?(t.signVisible=!1,t.$router.push({path:"/user/orderDetail",query:{productId:t.$route.query.productId,fromOrder_sn:t.$route.query.order_sn}})):t.$message.error(e.msg)}).catch(function(e){t.code="",console.log(e)}):this.$message.error("请输入验证码")},getData:function(){var t=this;$http.post("plugin.yun-sign.frontend.contract.detail-step3",{contract_id:this.contract_id}).then(function(e){1===e.result?(t.Data=e.data.contract_info,t.pdfUrl=t.Data.contract_doc_url,t.commonStructsList=e.data.form_list,t._loadFile(t.pdfUrl)):t.$message.error(e.msg)}).catch(function(t){console.log(t)})},postSignData:function(t){for(var e=this,s=[],o=!0,n=0;n<document.querySelectorAll(".text_mark").length;n++){if("inline-block"==document.querySelectorAll(".text_mark")[n].childNodes[0].childNodes[0].style.display&&!document.querySelectorAll(".text_mark")[n].childNodes[2].value){this.$message.error("存在未填写的文本域"),o=!1;break}s.push({id:document.querySelectorAll(".text_mark")[n].getAttribute("textId"),value:document.querySelectorAll(".text_mark")[n].childNodes[2].value})}o&&$http.post("plugin.yun-sign.frontend.contract.create-sign-doc",{id:this.contract_id,pdfWidth:this.pdfWidth/this.scale,pdfHeight:this.pdfHeight/this.scale,contract_form_params:s},"loading").then(function(s){1===s.result?1==t?e.$router.push(e.fun.getUrl("sign_contract",{id:e.contract_id})):e.$router.replace(e.fun.getUrl("launch")):e.$message.error(s.msg)}).catch(function(t){console.log(t)})},setTemplate:function(){for(var t=0;t<this.commonStructsList.length;t++)if(1==this.commonStructsList[t].form_type){var e=document.querySelector(".componentArea").cloneNode(!0);document.querySelector("#can"+this.commonStructsList[t].doc_page).appendChild(e),e.style.left=this.commonStructsList[t].pos_x+"px",e.style.top=this.commonStructsList[t].pos_y-10+"px",e.style.width=this.commonStructsList[t].width+"px",e.style.display="flex",e.classList.add("text_mark"),e.onmouseenter=this.TextMouseenter,e.onmouseleave=this.TextMouseleave,e.setAttribute("page",this.commonStructsList[t].doc_page),e.setAttribute("textId",this.commonStructsList[t].id),1==this.commonStructsList[t].is_require?e.childNodes[0].childNodes[0].style.display="inline-block":e.childNodes[0].childNodes[0].style.display="none",e.childNodes[0].childNodes[1].innerText=this.commonStructsList[t].form_name,e.childNodes[2].value=this.commonStructsList[t].form_value,e.childNodes[2].onfocus=this.TextFocus,e.childNodes[2].onblur=this.TextBlur}else{var s=document.querySelector(".componentSign").cloneNode(!0);document.querySelector("#can"+this.commonStructsList[t].doc_page).appendChild(s),s.style.left=this.commonStructsList[t].pos_x+"px",s.style.top=this.commonStructsList[t].pos_y+"px",s.style.display="flex",s.classList.add("text_mark2"),s.onmouseenter=this.sealMouseenter,s.onmouseleave=this.sealMouseleave,s.setAttribute("page",this.commonStructsList[t].doc_page),s.setAttribute("textId",this.commonStructsList[t].id),s.setAttribute("role_id",this.commonStructsList[t].role_id),s.childNodes[0].childNodes[1].childNodes[1].childNodes[1].innerText=this.commonStructsList[t].form_name,"1"==this.commonStructsList[t].role_id?s.childNodes[0].childNodes[1].childNodes[0].innerText="甲方":"2"==this.commonStructsList[t].role_id?s.childNodes[0].childNodes[1].childNodes[0].innerText="乙方":"3"==this.commonStructsList[t].role_id&&(s.childNodes[0].childNodes[1].childNodes[0].innerText="丙方")}},sealMouseenter:function(t){t.currentTarget.childNodes[0].style.display="flex"},sealMouseleave:function(t){t.currentTarget.childNodes[0].style.display="none"},clearAll:function(){for(var t=0;t<document.querySelectorAll(".text_mark").length;t++)document.querySelectorAll(".text_mark")[t].childNodes[0].style.display="none",document.querySelectorAll(".text_mark")[t].onmouseleave=this.TextMouseleave,document.querySelectorAll(".text_mark")[t].classList.remove("choose");this.hasChoose=!1},TextFocus:function(t){t.currentTarget.parentNode.childNodes[0].style.display="flex"},TextBlur:function(t){t.currentTarget.value=t.currentTarget.value.replace(/\s+/g,""),"inline-block"==t.currentTarget.parentNode.childNodes[0].childNodes[0].style.display&&""==t.currentTarget.value?(t.currentTarget.parentNode.classList.add("needFill"),t.currentTarget.parentNode.childNodes[3].style.display="flex"):(t.currentTarget.parentNode.classList.remove("needFill"),t.currentTarget.parentNode.childNodes[3].style.display="none")},TextMouseenter:function(t){t.currentTarget.childNodes[0].style.display="flex"},TextMouseleave:function(t){t.currentTarget.childNodes[0].style.display="none"},mouseenter:function(t){t.currentTarget.childNodes[0].style.display="block"},mouseleave:function(t){t.currentTarget.childNodes[0].style.display="none"},deleteIt:function(t){document.querySelector(".pdf-box").removeChild(t.currentTarget.parentNode)},signPic:function(t){var e=this,s=t.currentTarget.cloneNode(!0),o=0;document.querySelector("#app").clientWidth>1026&&(o=document.querySelector(".el-scrollbar__view").clientWidth),s.style.left=this.getPos(t).x-50-o+"px",s.style.top=this.getPos(t).y-130+"px",s.className="sign-img mark",document.querySelector("#pageContent").appendChild(s),document.onmousemove=function(t){s.style.left=e.getPos(t).x-parseInt(s.clientWidth/2)-o+"px",s.style.top=e.getPos(t).y-parseInt(s.clientHeight)-30+"px",s.className="sign-img mark"},document.onmouseup=function(t){return s.style.left=e.getPos(t).x+e.$refs.pdfBox.scrollLeft-parseInt(s.clientWidth/2)-document.querySelector(".pdf-box").offsetLeft-o+"px",s.style.top=e.getPos(t).y+e.scrollTop-parseInt(s.clientHeight/2)-130+"px",s.style.height=100*e.scale+"px",s.style.width=100*e.scale+"px",parseInt(s.style.left)<0?(document.onmousemove=null,document.onmouseup=null,document.querySelector("#pageContent").removeChild(s),void e.$message.error("请将印章拖拽到合同区域")):parseInt(s.style.left)>document.querySelector(".pdf-box").clientWidth-s.clientWidth?(document.onmousemove=null,document.onmouseup=null,document.querySelector("#pageContent").removeChild(s),void e.$message.error("请将印章拖拽到合同区域")):parseInt(s.style.top)<0?(document.onmousemove=null,document.onmouseup=null,document.querySelector("#pageContent").removeChild(s),void e.$message.error("请将印章拖拽到合同区域")):parseInt(s.style.left)>document.querySelector(".pdf-box").clientHeight-s.clientWidth?(document.onmousemove=null,document.onmouseup=null,document.querySelector("#pageContent").removeChild(s),void e.$message.error("请将印章拖拽到合同区域")):(document.querySelector("#pageContent").removeChild(s),document.querySelector(".pdf-box").appendChild(s),document.onmousemove=null,document.onmouseup=null,s.onmousedown=e.moveTo,s.onmouseenter=e.mouseenter,s.onmouseleave=e.mouseleave,void(s.childNodes[0].onclick=e.deleteIt))}},moveTo:function(t){var e=t.currentTarget,s=t.clientX-e.offsetLeft,o=t.clientY-e.offsetTop;document.onmousemove=function(t){var n=t.clientX-s,i=t.clientY-o;n<=0?n=0:n>=document.querySelector(".pdf-box").clientWidth-e.clientWidth?n=document.querySelector(".pdf-box").clientWidth-e.clientWidth:n-=10,i<=0?i=0:i>=document.querySelector(".pdf-box").clientHeight-e.clientWidth?i=document.querySelector(".pdf-box").clientHeight-e.clientWidth:i-=10,e.style.left=n+"px",e.style.top=i+"px"},document.onmouseup=function(t){document.onmousemove=null,document.onmouseup=null}},getPos:function(t){return{x:t.clientX,y:t.clientY}},toGetReal:function(){this.$router.push(this.fun.getUrl("accredited_institution",{},{productId:this.$route.query.productId,order_sn:this.$route.query.order_sn}))},handleClick:function(t,e){},handleChange:function(t){this.scale=t,this.queueRenderPage(this.pageNum)},handleScroll:function(t){var e=this;this.scrollTop=this.$refs.pdfBox.scrollTop;var s=[];document.querySelectorAll(".pdfPage_1yRne").forEach(function(t,o){e.scrollTop>=t.offsetTop&&s.push(o)}),this.page_num=Math.max.apply(null,s)+1},jump:function(){var t=this,e=this.page_num-1;if(e>this.page_count)this.$message.error("请输入有效范围内的数字");else{var s=document.querySelectorAll(".pdfPage_1yRne"),o=s[e].offsetTop,n=this.scrollTop,i=o/30>>0;if(o>n)!function e(){n<o?(n+=i,t.$refs.pdfBox.scrollTop=n,setTimeout(e,10)):t.$refs.pdfBox.scrollTop=o}();else i=(n-o)/30>>0,function e(){n>o?(n-=i,t.$refs.pdfBox.scrollTop=n,setTimeout(e,10)):t.$refs.pdfBox.scrollTop=o}()}},_renderPage:function(t){var e=this;this.pdfDoc.getPage(t).then(function(s){var o=document.getElementById("the-canvas"+t),n=o.getContext("2d"),i=s.getViewport(e.scale);e.pdfHeight=o.height=i.height,e.pdfWidth=o.width=i.width;var l={canvasContext:n,viewport:i};s.render(l),e.page_count>t&&e._renderPage(t+1)}),this.page_num=this.pageNum},_loadFile:function(t){var e=this;o.getDocument({url:t,cMapUrl:"https://cdn.jsdelivr.net/npm/pdfjs-dist@2.0.943/cmaps/",cMapPacked:!0}).then(function(t){e.pdfDoc=t,e.page_count=e.pdfDoc.numPages,e.$nextTick(function(){e._renderPage(1),e.isShow=!0,e.setTemplate()}),e.pageNum=1})},queueRenderPage:function(t){this._renderPage(t)}}},i=(s("l0sd"),s("ZrdR")),l=Object(i.a)(n,function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"big-box",attrs:{id:"pageContent"}},[o("div",{staticClass:"pageContent_2lAGg"},[o("div",{staticClass:"leftContent_2NoKi"},[o("div",{staticClass:"doc-list-context"},[t._m(0),t._v(" "),o("div",{staticClass:"doc-list"},[o("div",{staticStyle:{"font-size":"12px"}},[t._v("发起签署 -> 填写文本域")]),t._v(" "),o("div",{staticClass:"doc-item"},[o("div",{staticClass:"doc-img"},[o("img",{attrs:{src:s("3CBT"),alt:""}}),t._v(" "),o("div",{staticClass:"doc-page-num"},[t._v(t._s(t.page_count))])]),t._v(" "),o("div",{staticClass:"doc-name"},[t._v(t._s(t.Data.file_name))])]),t._v(" "),t._m(1)])])]),t._v(" "),o("div",{staticClass:"pdfContent_1PW2f"},[o("div",{staticClass:"pdf-header"},[o("div",{staticClass:"block"},[o("span",{staticClass:"demonstration"},[t._v(t._s(100*t.value1)+"%")]),t._v(" "),o("div",{staticClass:"slider"},[o("el-slider",{attrs:{min:.5,max:2,step:.25},on:{change:t.handleChange},model:{value:t.value1,callback:function(e){t.value1=e},expression:"value1"}})],1)]),t._v(" "),o("div",{staticClass:"input"},[o("span",[t._v("Page: "),o("input",{directives:[{name:"model",rawName:"v-model",value:t.page_num,expression:"page_num"}],staticClass:"input-text",attrs:{type:"text",placeholder:"1"},domProps:{value:t.page_num},on:{input:function(e){e.target.composing||(t.page_num=e.target.value)}}}),t._v(" / "+t._s(t.page_count))]),t._v(" "),o("el-button",{attrs:{type:"text"},on:{click:t.jump}},[t._v("跳转")])],1)]),t._v(" "),o("div",{directives:[{name:"loading",rawName:"v-loading",value:!t.isShow,expression:"!isShow"}],ref:"pdfBox",staticClass:"pdf-container",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.1)"}},[o("div",{staticClass:"pdf-box",style:{width:t.pdfWidth+"px"}},t._l(t.page_count,function(e){return o("div",{key:e,staticClass:"pdfPage_1yRne",style:{width:t.pdfWidth+"px",height:t.pdfHeight+"px"}},[o("canvas",{staticClass:"pdf-item",attrs:{id:"the-canvas"+e}}),t._v(" "),o("div",{staticClass:"dragLayer_3ccsq",attrs:{id:"can"+e}})])}))])]),t._v(" "),o("div",{staticClass:"taskInfoArea_3ThxW"},[o("div",{staticClass:"tab-bar"},[o("el-tabs",{on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}})],1),t._v(" "),o("div",{staticClass:"tab-context"},[o("div",{directives:[{name:"show",rawName:"v-show",value:1==t.activeName,expression:"activeName == 1"}],staticClass:"item"},[o("div",[t.Data.is_company?o("p",{staticClass:"title"},[t._v(t._s(t.Data.is_company.name))]):t._e(),t._v(" "),o("div",{staticClass:"seal-wrapper-item"},[o("div",{staticClass:"sign-img",staticStyle:{height:"100px",width:"100px"},on:{mousedown:t.signPic}},[o("div",{staticClass:"delete",on:{click:function(e){return e.stopPropagation(),t.deleteIt(e)}}},[t._v("删除")])])]),t._v(" "),o("div",{staticStyle:{"text-align":"center","margin-top":"20px"}},[o("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.showSign}},[t._v("确定签署")])],1)])]),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:2==t.activeName,expression:"activeName == 2"}],staticClass:"item"})])])]),t._v(" "),o("div",{staticStyle:{display:"flex","align-self":"center","margin-top":"10px"}},[o("el-button",{staticStyle:{width:"200px"},attrs:{type:"primary"},on:{click:function(e){t.postSignData("2")}}},[t._v("保存")]),o("el-button",{staticStyle:{width:"200px"},attrs:{type:"primary"},on:{click:function(e){t.postSignData("1")}}},[t._v("下一步")])],1),t._v(" "),o("el-dialog",{staticStyle:{margin:"0 auto","text-align":"center"},attrs:{title:"手机短信意愿认证",visible:t.signVisible,width:"600px","custom-class":"tips-dialog"},on:{"update:visible":function(e){t.signVisible=e}}},[o("div",{staticClass:"dialog-box"},[o("p",{staticClass:"phone"},[t._v("手机号码：  15553344878")]),t._v(" "),o("div",{staticClass:"send-code"},[o("p",{staticClass:"code-title"},[t._v("输入验证码：")]),o("el-input",{staticStyle:{"margin-right":"20px"},model:{value:t.code,callback:function(e){t.code="string"==typeof e?e.trim():e},expression:"code"}}),0==t.count?o("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.sendCode}},[t._v("获取手机验证码")]):t._e(),0!=t.count?o("el-button",{attrs:{type:"info",size:"small"}},[t._v(t._s(t.count)+" 秒后重新获取")]):t._e()],1)])])],1)},[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"doc-list-title"},[this._v("合同 "),e("span",[this._v("(1份)")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"componentsList_1OIrB"},[s("div",{staticClass:"componentArea"},[s("div",{staticClass:"itemConentStyle"},[s("span",{staticClass:"need"},[t._v("*")]),s("span",[t._v("文本名称")])]),t._v(" "),s("input",{staticClass:"input",attrs:{type:"text",placeholder:"请输入文本"}}),s("div",{staticClass:"errorInfo_3lZie"},[t._v("请填写当前控件")])]),t._v(" "),s("div",{staticClass:"componentSign"},[s("p",{staticClass:"sealCompInfo_3v9iQ"},[s("span",{staticClass:"need"},[t._v("*")]),s("span",[s("span",[t._v("甲方")]),s("em",[t._v("("),s("span",[t._v("签署区")]),t._v(")")])])]),s("div",{staticClass:"itemConentStyle_2MWEL"},[s("div",{staticClass:"infoMsg_3NkPg"},[t._v("签署区")]),s("i",{staticClass:"iconfont icon-pm_auction_success"})])])])}],!1,null,"6f65c342",null);l.options.__file="create_template_sign.vue";e.default=l.exports},QWYl:function(t,e,s){},l0sd:function(t,e,s){"use strict";var o=s("QWYl");s.n(o).a}}]);